<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Streaming Line Chart</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
  </head>
  <body>
    <svg width="800" height="400"></svg>
    <script>
      // Set up the chart dimensions
      const margin = { top: 20, right: 30, bottom: 30, left: 40 };
      const width = 800 - margin.left - margin.right;
      const height = 400 - margin.top - margin.bottom;

      // Create the x and y scales and axes
      const xScale = d3.scaleUtc()
        .range([0, width]);
      const yScale = d3.scaleLinear()
        .range([height, 0]);
      const xAxis = d3.axisBottom(xScale);
      const yAxis = d3.axisLeft(yScale);

      // Set up the line function for the chart
      const line = d3.line()
        .x((d) => xScale(d.time))
        .y((d) => yScale(d.value));

      // Create the initial line path and data points
      const svg = d3.select("svg");
      const path = svg.append("path")
        .attr("fill", "none")
        .attr("stroke", "steelblue")
        .attr("stroke-width", 2);
      const dataPoints = svg.append("g")
        .attr("fill", "steelblue")
        .attr("stroke", "none")
        .selectAll("circle");

      // Set up the empty data array and function to add new data points
      let data = [];
      const addData = (time, value) => {
        var parseTime = d3.timeParse("%Y/%m/%d")
        var time = parseTime(time)
        data.push({ time: new Date(time), value: +value });
        // console.log(data)
      };
      

      // Load the initial data and update the chart
    //   d3.csv("https://raw.githubusercontent.com/catbao/data_set/main/LineChart/line1.csv", (d) => addData(d.date, d.value)).then(() => {
    //     xScale.domain(d3.extent(data, (d) => d.time));
    //     yScale.domain(d3.extent(data, (d) => d.value));
    //     svg.append("g")
    //       .attr("transform", `translate(0, ${height})`)
    //       .call(xAxis);
    //     svg.append("g")
    //       .call(yAxis);
    //     updateLineChart();
    //   });

      // Update the chart with the current data every second
      setInterval(() => {
        d3.csv("https://raw.githubusercontent.com/catbao/data_set/main/LineChart/line1.csv", (d) => addData(d.date, d.value)).then(() => {
          xScale.domain(d3.extent(data, (d) => d.time));
          yScale.domain(d3.extent(data, (d) => d.value));
        svg.append("g")
          .attr("transform", `translate(0, ${height})`)
          .call(xAxis);
        svg.append("g")
          .call(yAxis);
          updateLineChart();
        });
      }, 1000);

      // Update the line path and data points with the current data
      const updateLineChart = () => {
        path.datum(data)
          .attr("d", line);
        dataPoints.data(data)
          .join("circle")
            .attr("cx", (d) => xScale(d.time))
            .attr("cy", (d) => yScale(d.value))
            .attr("r", 1);
      };
    </script>
  </body>
</html>
